\frame{
\frametitle{Schematic of \texttt{DGNet}}
\vspace{-2ex}
% \small
% \bluebox{Key idea}
{\small \texttt{DGNet} surrogate model is trained with 2nd-order strong stability preserving Runge-Kutta scheme.}
\vspace{1ex}
{

\def\layersep{2.cm}
\def\nodeinlayersep{.8cm}
\usetikzlibrary{calc}

% \raggedleft
% \centering
\resizebox{0.72\textwidth}{!}{
    \begin{tikzpicture}[
        node distance=\layersep,
        edge/.style={-stealth,shorten >=1pt, draw=black!50,thin, rounded corners=5pt},
        edge2/.style={draw=black!50,thin},
        neuron/.style={circle,fill=black!25,minimum size=10pt,inner sep=0pt},
        operator/.style={rectangle,fill=green!,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, inner sep=0pt, rounded corners},
        input neuron/.style={neuron, fill=green!50,minimum size=12pt},
        output neuron/.style={neuron, fill=green!50,minimum size=12pt},
        hidden neuron/.style={neuron,,draw=blue,thick fill=blue!5},
        Forward map/.style={operator, fill=red!50},
        annot/.style={text width=4em, text centered},
        every node/.style={scale=1.0},
        node1/.style={scale=2.0},
        cross/.style={path picture={ 
            \draw[black, shorten <=2pt, shorten >=2pt, line width=1pt] 
                (path picture bounding box.south) -- (path picture bounding box.north); 
            \draw[black, shorten <=2pt, shorten >=2pt, line width=1pt] 
                (path picture bounding box.west) -- (path picture bounding box.east);
        }}
    ]
    
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (u_in) at (3.5*\layersep, -.00*\nodeinlayersep) {$\ubr^{i} = \ui{{i,0}} + \epsb$};
    
    % DG GNN RHS tikz figure
    \node[rectangle,draw=blue,thick,fill=blue!40,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGGNN-1) at (1*\layersep, -2*\nodeinlayersep) {$\DGGNN$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (SL-DGGNN-1) at (1*\layersep, -4.8*\nodeinlayersep) {$S$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGGNN-RK-1) at (1*\layersep, -6.5*\nodeinlayersep) {$\ut{{i},1}$};
    \node [draw,circle,cross,minimum width=.02*\layersep,line width=.3pt](cross_1) at (1*\layersep, -3.6*\nodeinlayersep){};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (1.2*\layersep, -2.9*\nodeinlayersep) {\tiny $ \times \dt$};
    
    \draw[edge,thin] (u_in) -- (1*\layersep, -.00 *\nodeinlayersep) -- (DGGNN-1);
    \draw[edge,thin] (1*\layersep, -0.6 *\nodeinlayersep) -- (1*\layersep, -1 *\nodeinlayersep) -- (2*\layersep, -1 *\nodeinlayersep) -- (2*\layersep, -3.6 *\nodeinlayersep) -- (cross_1);
    \draw[edge,thin] (DGGNN-1) -- (cross_1);
    \draw[edge,thin] (cross_1) -- (SL-DGGNN-1);
    \draw[edge,thin] (SL-DGGNN-1) -- (DGGNN-RK-1);
    
    \node[rectangle,draw=blue,thick,fill=blue!40,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGGNN-2) at (1*\layersep, -8.5*\nodeinlayersep) {$\DGGNN$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (SL-DGGNN-2) at (1*\layersep, -11.6*\nodeinlayersep) {$S$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGGNN-RK-2) at (1*\layersep, -13.3*\nodeinlayersep) {$\ut{{i},2}$};
    \node [draw,circle,cross,minimum width=.02*\layersep,line width=.3pt](cross_2) at (1*\layersep, -10.1*\nodeinlayersep){};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (1.2*\layersep, -9.4*\nodeinlayersep) {\tiny $ \times \dt$};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (1.2*\layersep, -10.6*\nodeinlayersep) {\tiny $ \times \frac{1}{2}$};
    
    \draw[edge,thin] (DGGNN-RK-1) -- (DGGNN-2);
    \draw[edge,thin] (1*\layersep, -7.*\nodeinlayersep) -- (1*\layersep, -7.5*\nodeinlayersep) -- (2*\layersep, -7.5 *\nodeinlayersep) -- (2*\layersep, -10.1 *\nodeinlayersep) -- (cross_2);
    \draw[edge,thin] (DGGNN-2) -- (cross_2);
    \draw[edge,thin] (cross_2) -- (SL-DGGNN-2);
    \draw[edge,thin] (SL-DGGNN-2) -- (DGGNN-RK-2);
    
    \draw[edge,thin] (1*\layersep, -.6 *\nodeinlayersep) -- (1*\layersep, -1 *\nodeinlayersep) -- (0.*\layersep, -1 *\nodeinlayersep) -- (0.*\layersep, -10.1 *\nodeinlayersep) -- (cross_2);
    
    % DG solver RHS tikz figure
    \node[rectangle,fill=red!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGsol-1) at (6*\layersep, -2*\nodeinlayersep) {$\mc{F}$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (SL-DGsol-1) at (6*\layersep, -4.8*\nodeinlayersep) {$S$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGsol-RK-1) at (6*\layersep, -6.5*\nodeinlayersep) {$\ubar{{i},1}$};
    \node [draw,circle,cross,minimum width=.02*\layersep,line width=.3pt](cross_3) at (6*\layersep, -3.6*\nodeinlayersep){};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (6.2*\layersep, -2.9*\nodeinlayersep) {\tiny $ \times \dt$};
    
    \draw[edge,thin] (u_in) -- (6*\layersep, -.00 *\nodeinlayersep) -- (DGsol-1);
    \draw[edge,thin] (6*\layersep, -.6 *\nodeinlayersep)  -- (6*\layersep, -1 *\nodeinlayersep) -- (5*\layersep, -1 *\nodeinlayersep) -- (5*\layersep, -3.6 *\nodeinlayersep) -- (cross_3);
    \draw[edge,thin] (DGsol-1) -- (cross_3);
    \draw[edge,thin] (cross_3) -- (SL-DGsol-1);
    \draw[edge,thin] (SL-DGsol-1) -- (DGsol-RK-1);
    
    \node[rectangle,fill=red!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGsol-2) at (6*\layersep, -8.5*\nodeinlayersep) {$\mc{F}$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (SL-DGsol-2) at (6*\layersep, -11.6*\nodeinlayersep) {$S$};
    \node[rectangle,fill=yellow!50,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (DGsol-RK-2) at (6*\layersep, -13.3*\nodeinlayersep) {$\ubar{{i},2}$};
    \node [draw,circle,cross,minimum width=.02*\layersep,line width=.3pt](cross_4) at (6*\layersep, -10.1*\nodeinlayersep){};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (6.2*\layersep, -9.4*\nodeinlayersep) {\tiny $ \times \dt$};
    \node[rectangle,minimum height= \nodeinlayersep, minimum width= 1.2 * \layersep, rounded corners] (dt) at (6.2*\layersep, -10.6*\nodeinlayersep) {\tiny $ \times \frac{1}{2}$};
    
    \draw[edge,thin] (DGsol-RK-1) -- (DGsol-2);
    \draw[edge,thin] (6*\layersep, -7.*\nodeinlayersep) -- (6*\layersep, -7.5*\nodeinlayersep) -- (5*\layersep, -7.5 *\nodeinlayersep) -- (5*\layersep, -10.1 *\nodeinlayersep) -- (cross_4);
    \draw[edge,thin] (DGsol-2) -- (cross_4);
    \draw[edge,thin] (cross_4) -- (SL-DGsol-2);
    \draw[edge,thin] (SL-DGsol-2) -- (DGsol-RK-2);
    
    \draw[edge,thin] (6*\layersep, -.6 *\nodeinlayersep) -- (6*\layersep, -1 *\nodeinlayersep) -- (7.*\layersep, -1 *\nodeinlayersep) -- (7.*\layersep, -10.1 *\nodeinlayersep) -- (cross_4);
    
    \node[rectangle,fill=green!40,minimum height= \nodeinlayersep, minimum width= 1.6 * \layersep, rounded corners] (loss_mc) at (3.5*\layersep, -9.5*\nodeinlayersep) {\begin{tabular}{c} Loss  $\mc{L}_{mc}$: \vspace*{.2cm} \\  $\MSEdg{\ubar{{i},1} - \ut{{i},1}}$ \vspace*{.2cm} \\ $ + $ \vspace*{.2cm} \\ $ \MSEdg{\ubar{{i},2} - \ut{{i},2}}$ \end{tabular}};
    
    \draw[edge,thin] (DGGNN-RK-1) -- (3.5*\layersep, -6.5 *\nodeinlayersep) -- (loss_mc);
    \draw[edge,thin] (DGGNN-RK-2) -- (3.5*\layersep, -13.3 *\nodeinlayersep) -- (loss_mc);
    
    \draw[edge,thin] (DGsol-RK-1) -- (3.5*\layersep, -6.5 *\nodeinlayersep) -- (loss_mc);
    \draw[edge,thin] (DGsol-RK-2) -- (3.5*\layersep, -13.3 *\nodeinlayersep) -- (loss_mc);
    
    
    
    % ML loss  term 
    \node[rectangle,fill=green!40,minimum height= \nodeinlayersep, minimum width= 1.6 * \layersep, rounded corners] (loss_ml) at (-2.*\layersep, -9.5*\nodeinlayersep) {\begin{tabular}{c} Loss $\mc{L}_n$: \vspace*{.2cm} \\  $\MSEdg{\ui{{i},1} - \ut{{i},1}}$ \vspace*{.2cm} \\ $ + $ \vspace*{.2cm} \\ $ \MSEdg{\ui{{i},2} - \ut{{i},2}}$ \end{tabular}};
    
    \draw[edge2,thin] (DGGNN-RK-1) -- (.08*\layersep, -6.5 *\nodeinlayersep)
        arc [start angle=0, end angle=180, radius=0.08*\layersep] 
        -- (-1.*\layersep, -6.5 *\nodeinlayersep);
    \draw[edge,thin] (-1.*\layersep, -6.5 *\nodeinlayersep) -- (-2.*\layersep, -6.5 *\nodeinlayersep) -- (loss_ml);
    \draw[edge,thin] (DGGNN-RK-2) -- (-2.*\layersep, -13.3 *\nodeinlayersep) -- (loss_ml);
    
    % Pre-computed data
    \node[rectangle,fill=gray!40,minimum height= \nodeinlayersep, minimum width= 1.6 * \layersep, rounded corners] (data_set) at (-2.1*\layersep, 1.2*\nodeinlayersep) {\begin{tabular}{c} Pre-computed data \vspace*{.2cm} \\  $\ui{i,0}, \ui{i,1}, \ui{i,2}$ \end{tabular}};
    \draw[edge,thin] (data_set) -- (-2.1*\layersep, -7.58 *\nodeinlayersep);
    
    \draw[edge,thin] (data_set) -- (3.45*\layersep, 1.2 *\nodeinlayersep) -- (3.45*\layersep, .5 *\nodeinlayersep);
    
    % Randomize machine engine
    \node[rectangle,fill=gray!40,minimum height= \nodeinlayersep, minimum width= 1.6 * \layersep, rounded corners] (random_noise_engine) at (6*\layersep, 1.2*\nodeinlayersep) {\begin{tabular}{c} Random noise \vspace*{.2cm} \\  $\epsb \sim \mc{N} \LRp{\mathbf{0}, \delta^2 \LRs{\boldsymbol{\diag}\LRp{{\ui{i,0}}}}^2}$ \end{tabular}};
    \draw[edge,thin] (random_noise_engine) -- (3.55*\layersep, 1.2 *\nodeinlayersep) -- (3.55*\layersep, .5 *\nodeinlayersep);
    
    \end{tikzpicture}
}

}

}